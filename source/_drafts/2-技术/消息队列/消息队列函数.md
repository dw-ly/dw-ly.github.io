1.ftok函数

系统建立IPC通讯（如消息队列、共享内存时）必须指定一个ID值 。通常情况下，该id值通过ftok函数得到 。

函数原型

```c++
key_t ftok( char * fname, int id )
```

参数说明

> fname就时您指定的文档名
> id是子序号。

参考：[ftok () 函数介绍](https://blog.csdn.net/oceanlee2/article/details/4539503)

#### 二.消息队列函数

##### 1.msgget

###### 1.1函数作用

得到消息队列标识符或创建一个消息队列对象并返回消息队列标识符

###### 1.2函数说明

```c++
//头文件
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/msg.h>
//函数原型
int msgget(key_t key, int msgflg);

/*
参数说明
1.key
0(IPC_PRIVATE)：会建立新的消息队列
大于0的32位整数：视参数msgflg来确定操作。通常要求此值来源于ftok返回的IPC键值
2.msgflg
IPC_CREAT：当msgflg&IPC_CREAT为真时，如果内核中不存在键值与key相等的消息队列，则新建一个消息队列；如果存在这样的消息队列，返回此消息队列的标识符
IPC_CREAT|IPC_EXCL：如果内核中不存在键值与key相等的消息队列，则新建一个消息队列；如果存在这样的消息队列则报错
*/
```

##### 2.msgctl

###### 2.1函数作用

获取和设置消息队列的属性

###### 2.2函数说明

```c++
//头文件
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/msg.h>
//函数原型
int msgctl(int msqid, int cmd, struct msqid_ds *buf);

/*
参数说明
1.msqid
消息队列标识符
2.cmd
IPC_STAT:获得msgid的消息队列头数据到buf中
IPC_SET：设置消息队列的属性，要设置的属性需先存储在buf中，可设置的属性包括：msg_perm.uid、msg_perm.gid、msg_perm.mode以及msg_qbytes
buf：消息队列管理结构体，请参见消息队列内核结构说明部分
*/
```

##### 3.msgsnd

###### 3.1函数作用

将msgp消息写入到标识符为msqid的消息队列

###### 3.2函数说明

```c++
//头文件
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/msg.h>
//函数原型
int msgsnd(int msqid, const void *msgp, size_t msgsz, int msgflg);

/*
参数说明
1.msqid
消息队列标识符
2.msgp
发送给队列的消息。msgp可以是任何类型的结构体，但第一个字段必须为long类型，即表明此发送消息的类型，msgrcv根据此接收消息。msgp定义的参照格式如下：
    struct s_msg{		-->msgp定义的参照格式
    	long type;		-->必须大于0,消息类型 
    	char mtext[256];--> 消息正文，可以是其他任何类型
    } msgp;
3.msgsz
要发送消息的大小，不含消息类型占用的4个字节,即mtext的长度
4.msgflg
0：当消息队列满时，msgsnd将会阻塞，直到消息能写进消息队列
IPC_NOWAIT：当消息队列已满的时候，msgsnd函数不等待立即返回
IPC_NOERROR：若发送的消息大于size字节，则把该消息截断，截断部分将被丢弃，且不通知发送进程。
*/
```

##### 4.msgrcv

###### 4.1函数作用

从标识符为msqid的消息队列读取消息并存于msgp中，读取后把此消息从消息队列中删除

###### 4.2函数说明

```c++
//头文件
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/msg.h>
//函数原型
ssize_t msgrcv(int msqid, void *msgp, size_t msgsz, long msgtyp, int msgflg);
/*
参数说明
1.msqid
消息队列标识符
2.msgp
存放消息的结构体，结构体类型要与msgsnd函数发送的类型相同
3.msgsz
要接收消息的大小，不含消息类型占用的4个字节
4.msgtyp
0：接收第一个消息
>0：接收类型等于msgtyp的第一个消息
<0：接收类型等于或者小于msgtyp绝对值的第一个消息
5.msgflg
IPC_NOWAIT：如果没有返回条件的消息调用立即返回，此时错误码为ENOMSG
IPC_EXCEPT：与msgtype配合使用返回队列中第一个类型不为msgtype的消息
IPC_NOERROR：如果队列中满足条件的消息内容大于所请求的size字节，则把该消息截断，截断部分将被丢弃
*/
```

参考：[消息队列函数(msgget、msgctl、msgsnd、msgrcv)及其范例](https://blog.csdn.net/guoping16/article/details/6584024)

